# 监控 sdk 的功能

如果我们需要实现一个监控 sdk，那么我们先枚举一下我们需要的基础功能有哪些：

1. 埋点工具允许在初始化之前/初始化之后进行埋点上报
2. 监听常用的页面性能指标和错误
3. 非阻塞的埋点上报机制
4. 能够统计页面 pv，且支持自定义的埋点上报
5. 一份适合数据清洗的埋点协议

# 不阻塞渲染和埋点发生的初始化流程

# 埋点协议

按照之前我们的设想，我们现在只需要一份埋点协议就可以完成这个性能监控 sdk 了；现在我们就来完成这个事情

## 埋点协议的设计

首先埋点协议这件事情是一件很严肃且复杂度较高的事情，这关系到我们 SDK 的应用场景，数据的清洗，数据的扩展等等问题，我们这里只是简单理一下思路，实际场景中协议肯定是要专门设计讨论的

首先我们埋点的参数可分为两类：

1. 公参: 所有埋点携带的公共参数，用于串联数据以及描述基本的场景
2. 私参: 具体到场景的参数，完全由用户输入自定义

```js
{
  // 公参
  sessionId: '', // 表示会话id，sdk 初始化时由服务器返回/sdk提供算法生成，这里要求 sessionId 具有唯一性；我们可以使用这个id来进行页面的漏斗分析
  ua: '', // user-agent
  url: '', // 页面当前的 url

  // 私参
  // 私参的设计有两种思路，1. 完全由用户自定义，但是限制参数数量和长度 2. 给点默认的 key，然后让用户去使用
  // 这里我们只定义一个 type 私参，然后所有的其他私参完全由用户自定义
  type: '', // 表示埋点的类型，pv|performance|interface|error|other
}
```

然后我们公参私参只是一个默认设置，允许用户在埋点的时候进行二次覆盖(兼容不同的场景)

这样我们就简单设计了一个协议

# sdk 的实现
